---
title: "Technical Report"
author: "Kanyin Olagbegi and Will Lonnquist"
date: "12/14/2018"
output:
  pdf_document: default
  html_document: default
---
**Project Title:**

Factors Contributing to Success on the PGA TOUR

**Abstract:**

Our project analyzed player-based event statistics from all players who competed in 2018 PGA TOUR stroke play events to uncover characteristics which led to event success. We have defined event success as making the cut in an event since players who make the cut and complete the event receive payment for their performance while players who miss the cut receive no payment. Using a random forest method to establish statistics that are associated with making, or missing, the cut, we discovered that players who maximize their number of greens-in-regulation per round and their distance of putts made per round while minimizing their number of three-putts per round are more likely to have success in the event than players not excelling in these categories. These were the variables from our model of all predictors that had the highest *variable importance* in the random forest. From these findings, we believe PGA Tour players should focus on improving their ball-striking and putting in order to maximize their greens-in-regulation and distance of putts made, respectively, in every event they compete in, thus increasing their likelihood of making the cut and earning money.  

**Project Introduction:**

Our group approached this project with an interest in uncovering what leads professional golfers to success. Our goal for the investigation carried out below was to use raw player-based event statistics from all 2018 PGA TOUR stroke play events to determine what characteristics in a player's statistics contributed to their success. We defined success for a golfer in a PGA TOUR stroke play event as making the cut since players who make the cut and complete the event receive payment for their performance while players who miss the cut receive no payment. Our research into this topic may be important for PGA TOUR players as they can understand what statistics they should focus on maximizing (or minimizing) during their rounds so they can improve their chances of making the cut and making money. Our research may also be valuable to fans of the PGA TOUR so they can understand why certain players are making more cuts than others. 

We created a model, specifically a random forest model, that predicts the outcome for a player making or missing the cut in a probabilistic manner. We chose to use a random forest for two reasons. First, random forests generated a metric known as variable importance which associated a value with each predictor variable telling of that variable predictive influence on the response variable. This was useful for our investigation to see which statistics influenced whether or not a cut was made or not. Second, using the classification method was beyond on the scope of the course and forced us to explore topics not covered in class as was a requirement for the project. Random forests are a collection of decision trees, which take in variables in the dataset and create cutoff levels for those variables in order to make a prediction about the response variable. In our case the response variable was whether or not a cut was made (binary) and our five predictors variables were average number of greens in regulation per round (quantitative), average number of three-putts per round (quantitative), average distance of putts made per round (quantitative), average number of drivers over 300 yards per round (quantitative), and average distance to the hole on approach shots from 50-125 yards (quantitative). 

After fitting our model we examined the differences in variable importance of our predictor variables. The differences in variable importance between our five predictor variables showed some trends that we believe may be meaningful to the desired audiences of our project, PGA TOUR players and fans. The specifics of our discovery are outlined below.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r warning=FALSE, message=FALSE}
# Loading all packages required for analysis
library(readr)
library(dplyr)
library(ggplot2)
library(randomForest)
library(pROC)
library(tibble)
```

**Data:**

We gained access to the PGA TOUR's Shotlink Intelligence Program which contains data about PGA TOUR players, courses, and events. We exported the 2018 Event Detail file which contains player-based event statistics for all PGA TOUR sponsored events of the 2018 wrap-around season (some events played at the end of 2017 were included as they count towards the 2018 season). The dataset was downloaded as a semicolon-separated text file and uploaded into R as a dataframe. This dataset had 6173 observations of 203 variables covering all aspects of a golfer's play in an event. An observation in this dataset represented a specific player's statistics from an event. For example, statistics about Tiger Woods' performance at the 2018 Tour Championship could be found in one row of the dataset.

We modified this large dataset to make it more suitable for our needs. First, we filtered out events that were official PGA TOUR events such as the Ryder Cup, an international match play event, that the PGA TOUR still sponsors. We then modified the types of the variables we needed for analysis. When we uploaded the original dataset into R all variables were designated as characters, even though many of them were meant to be numerics. Then, we transformed the raw statistics present in the dataset we received access to from the PGA TOUR, typically from a total occurence count into a per-round average occurence count. For example, we took the total number of three-putts a player had in an event and divided that count by the total number of rounds played in that event by that player. This allowed us to account for increases to certain counts that may occur from players competing in more rounds than others. For example, players who make the cut will likely have higher average counts of number of drives over 300 yards since they will play 36 more holes of golf in that event than players who miss the cut, but they might not necessarily have more 300-yard drivers per round played. Next, we selected our newly transformed variable columns. Finally, we took out observations from a data that had missing values since we read online that random forests work better without any missing values. After wrangling the original dataset, we were left with a dataset of 4786 observations and 8 variables.

Codebook for our variables:

Response variable: 
cutMade - a binary variable with value 0 for a player who missed the cut and 1 for players who made the cut. Players strive to make the cut. 

Predictor variables:
1. GIRsPerRound - A quantitative variable detailing the average number of greens in regulation hit by a player per round in an event. A green in regulation occurs when a player's golf ball in on the green in two strokes less than the par for the hole. If a player's ball was on the green on a par 4 in 2 strokes they would have hit that green in regulation. Players strive to hit the green in regulation on every hole they play.   
2. ThreePuttsPerRound - A quantitative variable detailing the average number of three-putts by a player per round in an event. A three-putt occurs when a player takes three strokes on the green to get their ball into the hole. Players strive to avoid three-putts.  
3. over300DrivesPerRound - A quantitative variable detailing the average number of drivers over 300-yards hit by a player per round in an event. Hitting the ball far on a shot means the next shot will begin from closer to the hole and will thus be easier. 300-yards is an accepted threshold for what classifies as a far or long drive. Players strive to hit their drives over 300-yards when possible.  
4. distPuttsMadePerRound - a quantitative variable detailing the average total distance in feet of all putts holed by a player per round in an event. Making, or holing, a putt becomes exponentially harder as a player moves farther away from the hole so making long putts is an impressive task. Players strive to make every putt they have, but just making a few more long putts over the course of an event will add up.  
5. proxToHoleApproach - a quantitative variable detailing the average distance in feet that a player's ball winds up from the hole on approach shots from 50-125 yards per round in a event. Hitting the ball closer to the hole will give the player a better chance of making their upcoming putt. Players strive to hit the ball as close as possible to the hole from this approach shot distance range.  

Misc. variables:
1. `Player Name` - The name of the PGA TOUR player to whom the accompanying variables belong.  
2. `Event Name` - The name of the PGA TOUR event that the accompanying statistics were collected during.  

```{r warning=FALSE, message=FALSE}
# Reading in dataset accessed from pgatourhq.com
data <- read_delim('revent.TXT', delim = ";")
# Dimensions of original dataset
nrow(data)
ncol(data)

dataFinal <- data %>%
  
  # Filtering for PGA TOUR Stroke Play Events
  filter(`Official Event(Y/N)` == "Y") %>%
  
  # Changing variables to the proper types
  mutate(`Total Rounds` = as.numeric(`Total Rounds)`),
         `Finish Position(numeric)` = as.numeric(`Finish Position(numeric)`),
         `Drives Over 300 Yards (# of Drives)` = as.numeric(`Drives Over 300 Yards (# of Drives)`),
         `3-Putt Avoid(Total 3 Putts)` = as.numeric(`3-Putt Avoid(Total 3 Putts)`),
         `Avg Distance of Putts Made(Total Distance of Putts)` = as.numeric(`Avg Distance of Putts Made(Total Distance of Putts)`),
         `Total Holes Played` = as.numeric(`Total Holes Played`),
         `Total Greens in Regulation` = as.numeric(`Total Greens in Regulation`),
         `App. 50-125 Yards(ft)` = as.numeric(`App. 50-125 Yards(ft)`),
         `App.  50-125 Yards(attempts)` = as.numeric(`App.  50-125 Yards(attempts)`),
         
         #Creating our desired variables
         cutMade = as.factor(ifelse(`Finish Position(numeric)` < 999, 1, 0)),
         GIRsPerRound = `Total Greens in Regulation` / `Total Rounds`,
         ThreePuttsPerRound = `3-Putt Avoid(Total 3 Putts)` / `Total Rounds`,
         over300DrivesPerRound = `Drives Over 300 Yards (# of Drives)` /
           `Total Rounds`,
         distPuttsMadePerRound = `Avg Distance of Putts Made(Total Distance of Putts)` / `Total Rounds`,
         proxToHoleApproach = `App. 50-125 Yards(ft)` / `App.  50-125 Yards(attempts)`)  %>%

  #Selecting our desired columns
  select(`Player Name`,
        `Event Name`,
        cutMade,
        GIRsPerRound,
        ThreePuttsPerRound,
        over300DrivesPerRound,
        distPuttsMadePerRound,
        proxToHoleApproach)

# Removing observations with missing values 
# Source for code: https://stackoverflow.com/questions/4862178/remove-rows-with-all-or-some-nas-missing-values-in-data-frame 
dataFinal <- dataFinal[complete.cases(dataFinal), ]

# First six rows of modified dataset
head(dataFinal)
# Dimensions of modified dataset
nrow(dataFinal)
ncol(dataFinal)
```

```{r}
# Exploratory Data Analyis

ggplot(dataFinal, aes(x=cutMade, y=GIRsPerRound)) + 
  geom_boxplot() +
  ggtitle("Greens in Regulation Per Round For Cut/Non-Cut Players")

ggplot(dataFinal, aes(x=cutMade, y=proxToHoleApproach)) + 
  geom_boxplot() +
  ggtitle("Approach Shot Proximity Per Round For Cut/Non-Cut Players")
```

```{r warning=FALSE, message=FALSE}
# Splitting data into train and test subsets

# split 80/20 --------------------------
set.seed(123)
n <- nrow(dataFinal)
train_id <- sample(1:n, size=round(n*0.8)) # select approx 80% of the row numbers between 1 and n
train1 <- dataFinal[train_id,] # the data set we'll train the model on
test1 <- dataFinal[-train_id,] # the data set we'll test the model on
```

```{r warning=FALSE, message=FALSE}
# Building Random Forest


# Setting formula for random forest
f2 <- as.formula(cutMade ~ GIRsPerRound + ThreePuttsPerRound + over300DrivesPerRound + distPuttsMadePerRound + proxToHoleApproach)

# Training forest
set.seed(500)
mod_forest2 <- randomForest(f2, data = train1, ntree = 300, mtry = 2)
mod_forest2

sum(diag(mod_forest2$confusion)) / nrow(train1)

# predict on test and evaluate the model on test using auc-----------------------
pred_AUC2 <- predict(mod_forest2, test1, type = "prob")[,1]

test1 <- test1 %>% mutate(prediction2 = pred_AUC2)

roc_obj <- roc(test1$cutMade, test1$prediction2)
auc(roc_obj)
plot(roc_obj)
```

```{r message=FALSE, warning=FALSE}
# Variable Importance

# Get variable importance, code from textbook
importance(mod_forest2) %>%
  as.data.frame() %>%
  rownames_to_column() %>%
  arrange(desc(MeanDecreaseGini))

# Create Variable Importance Plot
varImpPlot(mod_forest2, main = "Variable Importance")
```

**Results:**

Results: an explanation of what your model tells me about the research question. You should interpret coefficients in context and explain their relevance. What does your model tell me that I didn’t already know before? You may want to include negative results, but be careful about how you interpret them. For example, you may want to say something along the lines of: “we found no evidence that explanatory variable x is associated with response variable y”, or “explanatory variable x did not provide any additional explanatory power above what was already conveyed by explanatory variable z.” On other hand, you probably shouldn’t claim: “there is no relationship between x and y.”

**Diagnostics:**

Diagnostics: a full diagnostic analysis of your model, with interpretation of Figures that you provide.

**Conclusions:**

Conclusion: a summary of your findings and a discussion of their limitations. First, remind the reader of the question that you originally set out to answer, and summarize your findings. Second, discuss the limitations of your model, and what could be done to improve it. You might also want to do the same for your data. This is your last opportunity to clarify the scope of your findings before a journalist misinterprets them and makes wild extrapolations! Protect yourself by being clear about what is not implied by your research.
Clear Repo

In this study, we hoped to determine the most important attributes needed to be successful as a professional golfer. Success was defined as making the cut which allowed players to make money. 